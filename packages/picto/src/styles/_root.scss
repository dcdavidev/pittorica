@use 'sass:map';
@use './variables/colors';
@use './variables/elevation';
@use './variables/font-stack';
@use './variables/font-weight';
@use './variables/letter-spacing';
@use './variables/line-height';
@use './variables/motion';
@use './variables/radius';
@use './variables/shapes';
@use './variables/spacing';
@use './variables/text-tokens';

/* -------------------------------------------------------
   Generate text vars
------------------------------------------------------- */
@mixin generate-text-vars($name, $map) {
  --picto-text-#{$name}: #{map.get($map, size)};
  --picto-text-#{$name}-line-height: #{map.get($map, line-height)};
  --picto-text-#{$name}-weight: #{map.get($map, weight)};
  --picto-text-#{$name}-tracking: #{map.get($map, tracking)};
}

:root {
  /* -------------------------------------------------------
     Font Stack
  ------------------------------------------------------- */
  @each $name, $value in font-stack.$fonts {
    --picto-font-#{$name}: #{$value};
  }

  /* Font Weight */
  @each $name, $value in font-weight.$font-weights {
    --picto-font-weight-#{$name}: #{$value};
  }

  /* Letter Spacing */
  --picto-letter-spacing-tight: #{letter-spacing.$letter-spacing-tight};
  --picto-letter-spacing-normal: #{letter-spacing.$letter-spacing-normal};
  --picto-letter-spacing-wide: #{letter-spacing.$letter-spacing-wide};
  --picto-letter-spacing-wider: #{letter-spacing.$letter-spacing-wider};

  /* Line Height */
  --picto-line-height-tight: #{line-height.$line-height-tight};
  --picto-line-height-normal: #{line-height.$line-height-normal};
  --picto-line-height-relaxed: #{line-height.$line-height-relaxed};

  /* Spacing */
  @each $name, $value in spacing.$spacing-semantic {
    --picto-space-#{$name}: #{$value};
  }

  /* Radius */
  @each $name, $value in radius.$radius-semantic {
    --picto-radius-#{$name}: #{$value};
  }

  /* Shapes */
  @each $name, $value in shapes.$shape-semantic {
    --picto-shape-#{$name}: #{$value};
  }

  /* Elevation */
  @each $name, $value in elevation.$elevation-semantic {
    --picto-elevation-#{$name}: #{$value};
  }

  /* Motion */
  @each $name, $transition in motion.$motion-transition-semantic {
    --picto-motion-#{$name}-duration: #{map.get($transition, duration)};
    --picto-motion-#{$name}-easing: #{map.get($transition, easing)};
  }

  /* -------------------------------------------------------
     Colors (0–100 scale)
  ------------------------------------------------------- */
  --picto-color-black: #{colors.$black};
  --picto-color-white: #{colors.$white};

  /* base palette export */
  @each $color-name, $color-scale in colors.$color-scales {
    @each $step, $value in $color-scale {
      --picto-color-#{$color-name}-#{$step}: #{$value};
    }
  }

  /* -------------------------------------------------------
     Semantic Tokens à la Material 3
     primary, on-primary, primary-container, on-primary-container, ecc.
  ------------------------------------------------------- */
  @each $token, $value in colors.$semantic-tokens {
    --picto-#{$token}: #{$value};
  }

  /* -------------------------------------------------------
     Text Tokens
  ------------------------------------------------------- */
  @each $name, $token in text-tokens.$text-styles {
    @include generate-text-vars($name, $token);
  }

  /* -------------------------------------------------------
     Text colors (M3 style)
     Light text = on-surface
     Dark text = surface
  ------------------------------------------------------- */
  --picto-text-primary: var(--picto-primary);
  --picto-text-secondary: var(--picto-secondary);
  --picto-text-tertiary: var(--picto-tertiary);

  --picto-text-neutral: var(--picto-neutral);
  --picto-text-neutral-variant: var(--picto-neutral-variant);

  --picto-text-error: var(--picto-error);
  --picto-text-success: var(--picto-success);
  --picto-text-info: var(--picto-info);
  --picto-text-danger: var(--picto-danger);

  /* On-colors */
  --picto-on-primary-text: var(--picto-on-primary);
  --picto-on-secondary-text: var(--picto-on-secondary);
  --picto-on-tertiary-text: var(--picto-on-tertiary);
  --picto-on-neutral-text: var(--picto-on-neutral);
  --picto-on-neutral-variant-text: var(--picto-on-neutral-variant);
  --picto-on-error-text: var(--picto-on-error);
  --picto-on-success-text: var(--picto-on-success);
  --picto-on-info-text: var(--picto-on-info);
  --picto-on-danger-text: var(--picto-on-danger);
}

/* -------------------------------------------------------
   DARK MODE INVERSION HELPER
   0 ↔ 100, 10 ↔ 90, 20 ↔ 80, ecc.
------------------------------------------------------- */
@function invert-step($step) {
  @return 100 - $step;
}

/* -------------------------------------------------------
   GENERATORE DI SEMANTIC TOKENS
   (primary, on-primary, primary-container, on-primary-container, ...)
------------------------------------------------------- */
@mixin generate-color-role($name, $scale, $mode) {
  $base: null;
  $on-base: null;
  $container: null;
  $on-container: null;

  @if $mode == light {
    $base: map.get($scale, 50);
    $on-base: if(map.get($scale, 90), map.get($scale, 100), colors.$white);

    $container: map.get($scale, 90);
    $on-container: map.get($scale, 10);
  } @else if $mode == dark {
    $base: map.get($scale, invert-step(80)); // molto più scuro in dark
    $on-base: map.get($scale, invert-step(20));

    $container: map.get($scale, invert-step(30));
    $on-container: map.get($scale, invert-step(90));
  }

  --picto-#{$name}: #{$base};
  --picto-on-#{$name}: #{$on-base};
  --picto-#{$name}-container: #{$container};
  --picto-on-#{$name}-container: #{$on-container};
}

/* -------------------------------------------------------
   THEME MIXIN
------------------------------------------------------- */
@mixin color-scheme($mode: light) {
  @each $name, $scale in colors.$color-scales {
    @include generate-color-role($name, $scale, $mode);
  }

  /* Surface system */
  @if $mode == light {
    --picto-surface: var(--picto-color-neutral-99);
    --picto-on-surface: var(--picto-color-neutral-10);
    --picto-surface-dim: var(--picto-color-neutral-87);
    --picto-surface-bright: var(--picto-color-neutral-98);
    --picto-outline: var(--picto-color-neutral-variant-50);
  } @else if $mode == dark {
    --picto-surface: var(--picto-color-neutral-7);
    --picto-on-surface: var(--picto-color-neutral-90);
    --picto-surface-dim: var(--picto-color-neutral-6);
    --picto-surface-bright: var(--picto-color-neutral-24);
    --picto-outline: var(--picto-color-neutral-variant-60);
  }
}

/* -------------------------------------------------------
   APPLY THEMES
------------------------------------------------------- */

:root {
  @include color-scheme(light);
}

[data-theme='dark'] {
  @include color-scheme(dark);
}
